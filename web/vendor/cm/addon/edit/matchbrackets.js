!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){function e(t,e,r){var i=t.getLineHandle(e.line),a=e.ch-1,l=r&&r.afterCursor;null==l&&(l=/(^| )cm-fat-cursor($| )/.test(t.getWrapperElement().className));var h=!l&&a>=0&&o[i.text.charAt(a)]||o[i.text.charAt(++a)];if(!h)return null;var s=">"==h.charAt(1)?1:-1;if(r&&r.strict&&s>0!=(a==e.ch))return null;var u=t.getTokenTypeAt(c(e.line,a+1)),f=n(t,c(e.line,a+(s>0?1:0)),s,u||null,r);return null==f?null:{from:c(e.line,a),to:f&&f.pos,match:f&&f.ch==h.charAt(0),forward:s>0}}function n(t,e,n,r,i){for(var a=i&&i.maxScanLineLength||1e4,l=i&&i.maxScanLines||1e3,h=[],s=i&&i.bracketRegex?i.bracketRegex:/[(){}[\]]/,u=n>0?Math.min(e.line+l,t.lastLine()+1):Math.max(t.firstLine()-1,e.line-l),f=e.line;f!=u;f+=n){var m=t.getLine(f);if(m){var g=n>0?0:m.length-1,d=n>0?m.length:-1;if(!(m.length>a))for(f==e.line&&(g=e.ch-(n<0?1:0));g!=d;g+=n){var k=m.charAt(g);if(s.test(k)&&(void 0===r||t.getTokenTypeAt(c(f,g+1))==r)){var p=o[k];if(">"==p.charAt(1)==n>0)h.push(k);else{if(!h.length)return{pos:c(f,g),ch:k};h.pop()}}}}}return f-n!=(n>0?t.lastLine():t.firstLine())&&null}function r(t,n,r){for(var i=t.state.matchBrackets.maxHighlightLineLength||1e3,o=[],l=t.listSelections(),h=0;h<l.length;h++){var s=l[h].empty()&&e(t,l[h].head,r);if(s&&t.getLine(s.from.line).length<=i){var u=s.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";o.push(t.markText(s.from,c(s.from.line,s.from.ch+1),{className:u})),s.to&&t.getLine(s.to.line).length<=i&&o.push(t.markText(s.to,c(s.to.line,s.to.ch+1),{className:u}))}}if(o.length){a&&t.state.focused&&t.focus();var f=function(){t.operation(function(){for(var t=0;t<o.length;t++)o[t].clear()})};if(!n)return f;setTimeout(f,800)}}function i(t){t.operation(function(){t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null),t.state.matchBrackets.currentlyHighlighted=r(t,!1,t.state.matchBrackets)})}var a=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),c=t.Pos,o={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};t.defineOption("matchBrackets",!1,function(e,n,r){r&&r!=t.Init&&(e.off("cursorActivity",i),e.state.matchBrackets&&e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null)),n&&(e.state.matchBrackets="object"==typeof n?n:{},e.on("cursorActivity",i))}),t.defineExtension("matchBrackets",function(){r(this,!0)}),t.defineExtension("findMatchingBracket",function(t,n,r){return(r||"boolean"==typeof n)&&(r?(r.strict=n,n=r):n=n?{strict:!0}:null),e(this,t,n)}),t.defineExtension("scanForBracket",function(t,e,r,i){return n(this,t,e,r,i)})});